name: Batch Pipeline

on:
  push:
    branches:
      - dev
      - jinja2
    # paths:
    #   - 'batch/**'
  workflow_run: # In order for this to work, you must use the default repo branch.
    workflows: ["Lambda Layer Pipeline"]
    branches: [dev]
    types:
      - completed

jobs:
  dev-use1:
    if: github.event_name == 'push' || ${{ github.event.workflow_run.outputs.env == 'dev' }}
    uses: ./.github/workflows/tfapply.yml
    with:
      data-pipeline: batch
      env: dev
      aws-region: us-east-1
      lambda-role-name: llandman-dev-lambda-exec-role
      tfprovider_alias: use1
      tfprovider_region: us-east-1
      # tfbackend_bucket: di-dev-terraform # make sure gh_oidc iam role has access to the bucket
      tfbackend_bucket: enverus-tfstates-0823
      tfbackend_key: dev/llandman/terraform.batch.tfstate
      tfbackend_region: us-east-1
      deploy: 'true' # must be set to 'true' to run `terraform apply` job


  
  # dev-usw2:
  #   # base_ref is the target branch
  #   if: github.event_name == 'pull_request' && github.event.base_ref == 'main'
  #   uses: ./.github/workflows/tfapply.yml
  #   with:
  #     env: prod # Change this to 'review' or 'prod' as needed
  #     aws-env-dir: dev-usw2
  #     aws-region: us-west-2
